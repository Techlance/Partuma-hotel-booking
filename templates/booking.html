
<!doctype html>
<html lang="en">

{% include 'header.html' %}
{% load static %}

<!-- //w3l-header -->
<section class="w3l-booking-top">
    <!-- /form-16-section -->
    <div class="booking-form-61">

      <div class="container">
        {% if messages %}
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
          {% for message in messages %}
          <strong>{{ message }}</strong>
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          {% endfor %}
        </div>
        {% endif %}

            <div class="booking-top-gds">
                <div class="form-right-inf">
                    <div class="booking-form-content">
                        <h6>Book Now</h6>
                        
                        <form action="booking" class="book-depature-6 signin-form" method="post" onsubmit="process(event)">
                        {% csrf_token %}
                            <div class="d-grid grid-col-2">
                                <div class="hny-frm_grid">
                                    <h5>Name</h5>
                                    <input class="name" name="name" type="text" placeholder="Your Name" required>
                                </div>
                                <div class="hny-frm_grid">
                                    <h5>Phone Number</h5>
                                    <input class="phone" id="phone_no" name="phone_number" type="tel" placeholder="Phone Number" required>
                                </div>
                                
                                <!-- <div class="hny-frm_grid">
                                    <h5>Check-in Date</h5>
                                    <input class="date" name="Text" type="date" placeholder="Date" required="">
                                </div>
                                <div class="hny-frm_grid">
                                    <h5>Check-out Date</h5>
                                    <input class="date" name="Text" type="date" placeholder="Date" required="">
                                </div> -->
                            </div>
                            <div class="d-grid mt-3">
                              <div class="hny-frm_grid">
                                <h5>E-mail</h5>
                                <input class="" name="email" type="email" placeholder="Email ID" required>
                            </div>
                          </div>  
                            <div class="d-grid hny-frm_grid mt-3" >
                              <h5>Check-in/check-out Date</h5>
                              <input 
                                  type="text" 
                                  id="from"
                                  name="check_in" 
                                  placeholder="Check-in/check-out Date" 
                                  pattern="[0-9]{4}[-]{1}[0-9]{2}[-]{1}[0-9]{2} [-] [0-9]{4}[-]{1}[0-9]{2}[-]{1}[0-9]{2}" 
                                  autocomplete="off"
                                  required 
                              />
                            </div>
                            <div class="d-grid grid-col-2 mt-3">
                              <div class="hny-frm_grid">
                                  <h5>Room Type</h5>
                                  <select id="room_type" name="room_type" required>
                                  {% if room_type %}
                                    <option value="{{room_type_id}}">{{room_type}}</option>
                                    {% for i in rooms %}
                                      {% ifequal i.id room_type_id %}
                                      {% else %}
                                      <option value="{{i.id}}">{{ i.room_type }} </option>
                                      {% endifequal %}
                                      {% endfor %}
                                  {% else %}
                                  {% for i in rooms %}
                                      <option value="{{i.id}}">{{ i.room_type }} </option>
                                      {% endfor %}
                                    {% endif %}
                                  </select>
                              </div>
                              <div class="hny-frm_grid">
                                  <h5>Number of Rooms</h5>
                                  <select id="no_of_rooms" name="no_of_rooms" required>
                                      <option value="1">1</option>
                                      <option value="2">2</option>
                                      <option value="3">3</option>
                                      <option value="4">4</option>
                                  </select>
                              </div>
                          </div>
                            <div class="d-grid grid-col-2 mt-3">
                                <div class="hny-frm_grid">
                                    <h5>Adults</h5>
                                    <select id="no_of_adults" name="no_of_adults" required>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                    </select>
                                </div>
                                <div class="hny-frm_grid">
                                    <h5>Children</h5>
                                    <select id="no_of_children" name="no_of_children" required>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                    </select>
                                </div>
                            </div>
                           
                         
                            <div class="d-grid grid-col-2 mt-3">
                              <div class="hny-frm_grid">
                                  <h5>Price</h5>
                                  <p style="color:#000; font-size:30px; display:inline">R
                                    <p id="price" style="color:#f57b51; font-size:24px;display:inline;"></p>
                                    <!-- <p style="color:#000; font-size:30px; display:inline">R</p> -->
                                </p>
                               
                              </div>

                              <div class="hny-frm_grid">
                                  <h5>Number of Available Rooms</h5>
                                    <p 
                                      id="available" 
                                      style="color:#f57b51; font-size:20px; display:inline;"
                                    >
                                      NaN
                                    </p>
                                    <p></p>
                              </div>
                            </div>

                            <input type="submit" value="Book Now" style="background-color:#f57b51; color:#fff" class="btn btn-style btn-secondary book mt-3 mb-3">
                           
                        </form>
                        <div>
                          <b>Note</b>: By continuing you will receive a verification code on your phone number by SMS. Message and data rates may apply.
                        </div>
                    </div>
                </div>

                <div class="booking-forms-16-info align-self">
                  <h5>Your Reservation</h5>
                  <h3 class="title-big">Select the Room, check for availability and book it.</h3>
                  <p>Lorem ipsum dolor sit amet,Ea consequuntur illum facere aperiam sequi optio consectetur
                      adipisicing elit Ea consequuntur illum.</p>
              </div>
            </div>
        </div>
    </div>
</section>
<!-- //form-16-section -->
{% include 'footer.html' %} 
<!-- Template JavaScript -->
<script src="static/js/jquery-3.3.1.min.js"></script>

<!-- <script src="assets/js/owl.carousel.js"></script>
 -->

<!-- phone-number -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>

<script>
//   function getIp(callback) {
//  fetch('https://wft-geo-db.p.rapidapi.com/v1/geo/adminDivisions', { headers: { 'Accept': 'application/json' }})
//    .then((resp) => resp.json())
//    .catch(() => {
//      return {
//        country: 'us',
//      };
//    })
//    .then((resp) => callback(resp.country));
// }

  const phoneInputField = document.querySelector("#phone_no");
  // const phoneInput = window.intlTelInput(phoneInputField, {
  // initialCountry: "auto",
  // geoIpLookup: getIp,
  // utilsScript:
  //   "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
  // });

  const phoneInput = window.intlTelInput(phoneInputField, {
    preferredCountries: ["za","zw","na","bw","mz","zm","ke","ug","mg","us","in"],

    utilsScript:
      "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
  });

function process(event) {

 const phoneNumber = phoneInput.getNumber();
 var inputF = document.getElementById("phone_no");
 inputF.value = phoneNumber;

}


</script>

<!-- disable body scroll which navbar is in active -->
<script>
$(function () {
  $('.navbar-toggler').click(function () {
    $('body').toggleClass('noscroll');
  })
});
</script>
<!-- disable body scroll which navbar is in active -->

<script src="static/js/bootstrap.min.js"></script>





<link rel="stylesheet" href="{% static '/css/hotel-datepicker.css' %}">

<script src="https://unpkg.com/fecha@4.0.0/lib/fecha.umd.js"></script>

<script src="{% static 'js/hotel-datepicker.min.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

<script>

var input = document.getElementById('from');
var datepicker = new HotelDatepicker(input);
var todayDate = new Date().toISOString().slice(0, 10);
var tomorrowDate = new Date();
tomorrowDate.setDate(tomorrowDate.getDate()+1);
tomorrowDate=tomorrowDate.toISOString().slice(0, 10);

input.value = todayDate+" - "+tomorrowDate;

datepicker.onSelectRange = function () {
  var event = new Event('change');
  input.dispatchEvent(event);
}

</script>



<script>
  $(document).ready(function(){
    var room_type = $("#room_type").val();
    var no_of_rooms = $("#no_of_rooms").val();
    if(no_of_rooms == null){
      no_of_rooms=1;
    }
    var check_in = $("#from").val();
    
    $.ajax({
      url: 'ajax/send_data',
      type: "POST",
       
      data: {
        'room_type': room_type,
        'no_of_rooms':no_of_rooms,
        'check_in':check_in,
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      dataType: 'json',
      success: function (data) {
          $('#price').html(data.price);
          

          var options = "";
          for(i=0;i<parseInt(data.max_person);i++)
          {
            options += `<option value="${i+1}">${i+1}</option>`;
            
          }
          $('#no_of_adults').html(options);


          var options2 = "";

          for(i=0;i<parseInt(parseInt(data.max_person)/2)+1;i++)
          {
            options2 += `<option value="${i+1}">${i+1}</option>`;
          }
          $('#no_of_children').html(options2);
          
          var options1 = "";
          
        
            for(i=0;i<parseInt(data.no_of_rooms_available);i++)
          {
            options1 += `<option value="${i+1}">${i+1}</option>`;
          }
          $("#no_of_rooms").html(options1);

      
          
          $("#available").html(data.no_of_rooms_available);

        }
    });

    
    $("#from, #room_type").change(function () {
    var room_type = $("#room_type").val();
    var no_of_rooms = $("#no_of_rooms").val();
    // console.log("hello");
    // console.log(room_type);
    if(no_of_rooms == null){
      no_of_rooms=1;
    }
   
    var check_in = $("#from").val(); // "2021-07-05 - 2021-07-06"
    
    $.ajax({
      url: 'ajax/send_data',
      type: "POST",
       
      data: {
        'room_type': room_type,
        'no_of_rooms':no_of_rooms,
        'check_in':check_in,
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      dataType: 'json',
      success: function (data) {
          // console.log("hi");
          // console.log(data.max_person);
          var options = "";
          for(i=0;i<parseInt(data.max_person);i++)
          {
            options += `<option value="${i+1}">${i+1}</option>`;
          }
          $('#no_of_adults').html(options);

          var options2 = "";

          for(i=0;i<parseInt(parseInt(data.max_person)/2)+1;i++)
          {
            options2 += `<option value="${i+1}">${i+1}</option>`;
          }
          $('#no_of_children').html(options2);

          var options1 = "";
          var mod=parseInt(data.no_of_rooms_available);
          no_of_rooms=parseInt(no_of_rooms);
          if(no_of_rooms<=mod)
          {
          $('#price').html(data.price);
          }
          // console.log(mod);
          // console.log(no_of_rooms);
          if(no_of_rooms>mod)
          {
            no_of_rooms=1;
            $.ajax(
              {
                url: 'ajax/send_data',
                type: "POST",
                
                data: {
                  'room_type': room_type,
                  'no_of_rooms':no_of_rooms,
                  'check_in':check_in,
                  csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                dataType: 'json',
                success: function (data) {
                    $('#price').html(data.price);
                }
              }
            );
          }
          for(i=1;i<=mod;i++)
          {
            if(i==no_of_rooms)
            {
              options1+=`<option value="${i}" selected >${i}</option>`;
            }
            else
            {
              options1+=`<option value="${i}">${i}</option>`;
            }
            
          }
          
          $("#no_of_rooms").html(options1);
          $("#available").html(data.no_of_rooms_available);
        }
    });

  });
});
</script>

<script>

  $(document).ready(function(){
    
     $("#no_of_rooms").change(function () {
       console.log("hi");
    var room_type = $("#room_type").val();
    var no_of_rooms = $("#no_of_rooms").val();
    if(no_of_rooms == null){
      no_of_rooms=1;
    }
    var check_in = $("#from").val(); // "2021-07-05 - 2021-07-06"
    
    $.ajax({
      url: 'ajax/send_data',
      type: "POST",
       
      data: {
        'room_type': room_type,
        'no_of_rooms':no_of_rooms,
        'check_in':check_in,
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      dataType: 'json',
      success: function (data) {
          $('#price').html(data.price);

          var options = "";
          for(i=0;i<parseInt(data.max_person);i++)
          {
            options += `<option value="${i+1}">${i+1}</option>`;
          }
          $('#no_of_adults').html(options);

          var options2 = "";

          for(i=0;i<parseInt(parseInt(data.max_person)/2)+1;i++)
          {
            options2 += `<option value="${i+1}">${i+1}</option>`;
          }
          $('#no_of_children').html(options2);

         
          $("#available").html(data.no_of_rooms_available);
        }
    });

  });
});
</script>

</body>

</html>